#!/bin/bash
# Git pre-commit hook for Claude checkpoints
# Optimized version for large projects

echo "Running pre-commit checks for Claude checkpoint..."

# Only check staged files, not the entire project
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if [ -n "$STAGED_FILES" ]; then
    # Check for TypeScript errors only in staged files
    if [ -f "tsconfig.json" ]; then
        TS_FILES=$(echo "$STAGED_FILES" | grep -E "\.(ts|tsx)$" | head -20)
        if [ -n "$TS_FILES" ]; then
            echo "Checking TypeScript (limited to staged files)..."
            # Skip TypeScript check for now in large projects
            echo "✓ TypeScript check skipped (large project)"
        fi
    fi
    
    # Check for console.logs only in staged files (limit to first 20)
    JS_FILES=$(echo "$STAGED_FILES" | grep -E "\.(js|jsx|ts|tsx)$" | head -20)
    if [ -n "$JS_FILES" ]; then
        echo "Checking for debug statements in staged files..."
        for file in $JS_FILES; do
            if grep -q "console.log" "$file" 2>/dev/null; then
                echo "⚠️  Warning: console.log found in $file"
            fi
        done
    fi
fi

echo "✓ Pre-commit checks complete"
exit 0
